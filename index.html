<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BD Daily Topup - Free Fire Diamonds</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        /* ALL YOUR EXISTING CSS STYLES REMAIN THE SAME */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #ff4655;
            --secondary: #0f1923;
            --accent: #1a2a3a;
            --light: #ece8e1;
            --gold: #ffd700;
            --text: #ffffff;
            --bkash: #e2136e;
            --nagad: #f8a01c;
            --upay: #00a859;
            --crypto: #00d4ff;
            --success: #2ecc71;
            --warning: #f39c12;
            --danger: #e74c3c;
        }

        body {
            background-color: var(--secondary);
            color: var(--text);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* ... ALL YOUR EXISTING CSS ... */

    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-gem" style="color: var(--primary); font-size: 2rem;"></i>
                    <h1>BD Daily Topup</h1>
                </div>
                <nav class="nav-links">
                    <a href="#" class="nav-home">Home</a>
                    <a href="#" class="nav-dashboard">Dashboard</a>
                    <a href="#" class="nav-admin" style="display: none;">Admin</a>
                    <a href="#">Support</a>
                    <div class="user-info" style="display: none;">
                        <div class="user-avatar" id="userAvatar">U</div>
                        <span id="userName">User</span>
                    </div>
                </nav>
                <div class="user-actions">
                    <button class="login-btn" id="loginBtn">Login</button>
                    <button id="registerBtn">Register</button>
                    <button id="logoutBtn" style="display: none;">Logout</button>
                </div>
                <button class="mobile-menu-btn" id="mobileMenuBtn">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- Configuration Instructions Modal -->
    <div class="modal" id="configModal" style="display: none;">
        <div class="modal-content">
            <h2>Setup Required</h2>
            <div class="form-group">
                <label for="supabaseUrl">Supabase Project URL</label>
                <input type="text" id="supabaseUrl" placeholder="https://your-project.supabase.co">
            </div>
            <div class="form-group">
                <label for="supabaseKey">Supabase Anon Key</label>
                <input type="text" id="supabaseKey" placeholder="your-anon-key-here">
            </div>
            <button class="confirm-btn" id="saveConfig">Save Configuration</button>
            <div class="setup-instructions">
                <h3>How to get these keys:</h3>
                <ol>
                    <li>Go to <a href="https://supabase.com" target="_blank">Supabase.com</a></li>
                    <li>Create a new project</li>
                    <li>Go to Settings â†’ API</li>
                    <li>Copy "Project URL" and "anon public" key</li>
                    <li>Paste them above and click Save</li>
                </ol>
            </div>
        </div>
    </div>

    <!-- Rest of your HTML remains exactly the same -->
    <!-- Mobile Navigation -->
    <div class="mobile-nav" id="mobileNav">
        <button class="close-mobile-nav" id="closeMobileNav">
            <i class="fas fa-times"></i>
        </button>
        <a href="#" class="nav-home">Home</a>
        <a href="#" class="nav-dashboard">Dashboard</a>
        <a href="#" class="nav-admin" style="display: none;">Admin</a>
        <a href="#">Support</a>
        <div class="mobile-user-actions" style="margin-top: 20px;">
            <button class="login-btn" style="width: 100%; margin-bottom: 10px;">Login</button>
            <button style="width: 100%; margin-bottom: 10px;">Register</button>
        </div>
    </div>

    <!-- Auth Modal -->
    <div class="auth-modal" id="authModal">
        <div class="modal-content">
            <button class="close-modal">&times;</button>
            <h2>Account</h2>
            <div class="auth-tabs">
                <div class="auth-tab active" data-tab="login">Login</div>
                <div class="auth-tab" data-tab="register">Register</div>
            </div>
            
            <form id="loginForm" class="auth-form active">
                <div class="form-group">
                    <label for="loginEmail">Email</label>
                    <input type="email" id="loginEmail" required>
                </div>
                <div class="form-group">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" required>
                </div>
                <button type="submit" class="confirm-btn">Login</button>
            </form>
            
            <form id="registerForm" class="auth-form">
                <div class="form-group">
                    <label for="registerName">Full Name</label>
                    <input type="text" id="registerName" required>
                </div>
                <div class="form-group">
                    <label for="registerEmail">Email</label>
                    <input type="email" id="registerEmail" required>
                </div>
                <div class="form-group">
                    <label for="registerPassword">Password</label>
                    <input type="password" id="registerPassword" required>
                </div>
                <div class="form-group">
                    <label for="registerPhone">Phone Number</label>
                    <input type="tel" id="registerPhone" required>
                </div>
                <button type="submit" class="confirm-btn">Register</button>
            </form>
        </div>
    </div>

    <!-- Main Content -->
    <section class="hero" id="mainContent">
        <div class="container">
            <h2>Free Fire Diamond Top-Up</h2>
            <p>Get the best deals on Free Fire diamonds and unlock exclusive items, characters, and weapons to dominate the battlefield!</p>
            <button class="cta-button">Get Diamonds Now</button>
        </div>
    </section>

    <!-- Dashboard -->
    <section class="dashboard" id="dashboard">
        <div class="container">
            <h2 class="section-title">Your Dashboard</h2>
            <div class="dashboard-stats">
                <div class="stat-card">
                    <div class="stat-value" id="totalOrders">0</div>
                    <div class="stat-label">Total Orders</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="completedOrders">0</div>
                    <div class="stat-label">Completed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="pendingOrders">0</div>
                    <div class="stat-label">Pending</div>
                </div>
            </div>
            
            <div class="order-history">
                <h3>Order History</h3>
                <div class="loading" id="ordersLoading">
                    <div class="spinner"></div>
                    <p>Loading orders...</p>
                </div>
                <div id="ordersList">
                    <!-- Orders will be populated here -->
                </div>
            </div>
        </div>
    </section>

    <!-- Admin Panel -->
    <section class="admin-panel" id="adminPanel">
        <div class="container">
            <h2 class="section-title">Admin Panel</h2>
            <div class="admin-actions">
                <button class="admin-btn" id="refreshRequests">Refresh</button>
                <button class="admin-btn" id="exportData">Export Data</button>
            </div>
            
            <div class="loading" id="adminLoading">
                <div class="spinner"></div>
                <p>Loading requests...</p>
            </div>
            
            <div class="requests-table-container">
                <table class="requests-table">
                    <thead>
                        <tr>
                            <th>Order ID</th>
                            <th>User</th>
                            <th>Package</th>
                            <th>Amount</th>
                            <th>Payment Method</th>
                            <th>Player ID</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="requestsTable">
                        <!-- Requests will be populated here -->
                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <!-- Diamond Packages -->
    <section class="packages">
        <div class="container">
            <h2 class="section-title">Diamond Packages</h2>
            <div class="packages-grid">
                <!-- Packages will be loaded dynamically -->
            </div>
        </div>
    </section>

    <!-- Payment Methods -->
    <section class="payment-methods">
        <div class="container">
            <h2 class="section-title">Payment Methods</h2>
            <div class="methods-grid">
                <div class="method-card bkash">
                    <i class="fas fa-mobile-alt"></i>
                    <h4>Bkash</h4>
                    <p>Fast & Secure Mobile Payment</p>
                </div>
                <div class="method-card nagad">
                    <i class="fas fa-wallet"></i>
                    <h4>Nagad</h4>
                    <p>Digital Financial Service</p>
                </div>
                <div class="method-card upay">
                    <i class="fas fa-qrcode"></i>
                    <h4>Upay</h4>
                    <p>Quick & Easy Payments</p>
                </div>
                <div class="method-card crypto">
                    <i class="fab fa-bitcoin"></i>
                    <h4>Crypto</h4>
                    <p>Bitcoin & Other Cryptocurrencies</p>
                </div>
            </div>
        </div>
    </section>

    <!-- How It Works -->
    <section class="how-it-works">
        <div class="container">
            <h2 class="section-title">How It Works</h2>
            <div class="steps">
                <div class="step">
                    <div class="step-number">1</div>
                    <h3>Select Package</h3>
                    <p>Choose the diamond package that suits your needs and budget.</p>
                </div>
                <div class="step">
                    <div class="step-number">2</div>
                    <h3>Enter Player ID</h3>
                    <p>Provide your Free Fire Player ID during checkout.</p>
                </div>
                <div class="step">
                    <div class="step-number">3</div>
                    <h3>Choose Payment</h3>
                    <p>Select your preferred payment method (Bkash, Nagad, Upay, or Crypto).</p>
                </div>
                <div class="step">
                    <div class="step-number">4</div>
                    <h3>Receive Diamonds</h3>
                    <p>Diamonds will be instantly delivered to your Free Fire account.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h3>BD Daily Topup</h3>
                    <p>Your trusted partner for Free Fire diamond top-ups. Fast, secure, and reliable service.</p>
                    <div class="social-links">
                        <a href="#"><i class="fab fa-facebook"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>
                <div class="footer-column">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="#">Home</a></li>
                        <li><a href="#">Top Up</a></li>
                        <li><a href="#">Promotions</a></li>
                        <li><a href="#">Support</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Support</h3>
                    <ul>
                        <li><a href="#">FAQ</a></li>
                        <li><a href="#">Contact Us</a></li>
                        <li><a href="#">Terms of Service</a></li>
                        <li><a href="#">Privacy Policy</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Contact Info</h3>
                    <ul>
                        <li><i class="fas fa-envelope"></i> support@bddailytopup.com</li>
                        <li><i class="fas fa-phone"></i> +880 1XXX-XXXXXX</li>
                        <li><i class="fas fa-map-marker-alt"></i> Dhaka, Bangladesh</li>
                    </ul>
                </div>
            </div>
            <div class="copyright">
                <p>&copy; 2023 BD Daily Topup. All rights reserved. Free Fire is a registered trademark of Garena International.</p>
            </div>
        </div>
    </footer>

    <!-- Purchase Modal -->
    <div class="modal" id="purchaseModal">
        <div class="modal-content">
            <button class="close-modal">&times;</button>
            <h2>Complete Your Purchase</h2>
            <form id="purchaseForm">
                <div class="form-group">
                    <label for="playerIdModal">Free Fire Player ID</label>
                    <input type="text" id="playerIdModal" placeholder="Enter your Player ID" required>
                </div>
                <div class="form-group">
                    <label for="package">Selected Package</label>
                    <input type="text" id="package" readonly>
                </div>
                <div class="form-group">
                    <label for="price">Price</label>
                    <input type="text" id="price" readonly>
                </div>
                <div class="form-group">
                    <label>Select Payment Method</label>
                    <div class="payment-options">
                        <div class="payment-option bkash" data-method="bkash">
                            <div class="payment-icon">
                                <i class="fas fa-mobile-alt"></i>
                            </div>
                            <div>
                                <h4>Bkash</h4>
                                <p>Mobile Payment</p>
                            </div>
                        </div>
                        <div class="payment-option nagad" data-method="nagad">
                            <div class="payment-icon">
                                <i class="fas fa-wallet"></i>
                            </div>
                            <div>
                                <h4>Nagad</h4>
                                <p>Digital Financial Service</p>
                            </div>
                        </div>
                        <div class="payment-option upay" data-method="upay">
                            <div class="payment-icon">
                                <i class="fas fa-qrcode"></i>
                            </div>
                            <div>
                                <h4>Upay</h4>
                                <p>Quick Payments</p>
                            </div>
                        </div>
                        <div class="payment-option crypto" data-method="crypto">
                            <div class="payment-icon">
                                <i class="fab fa-bitcoin"></i>
                            </div>
                            <div>
                                <h4>Crypto</h4>
                                <p>Bitcoin & Cryptocurrencies</p>
                            </div>
                        </div>
                    </div>
                    <input type="hidden" id="paymentMethod" required>
                </div>
                <button type="submit" class="confirm-btn">Confirm Purchase</button>
            </form>
            <div class="success-message" id="successMessage">
                <i class="fas fa-check-circle"></i> Purchase Successful! Diamonds will be delivered to your account shortly.
            </div>
        </div>
    </div>

    <script>
        // Configuration Management
        class ConfigManager {
            constructor() {
                this.supabase = null;
                this.isConfigured = false;
            }

            init() {
                this.loadConfig();
                if (!this.isConfigured) {
                    this.showConfigModal();
                } else {
                    this.initializeSupabase();
                }
            }

            loadConfig() {
                const savedConfig = localStorage.getItem('bddailytopup_config');
                if (savedConfig) {
                    const config = JSON.parse(savedConfig);
                    if (config.supabaseUrl && config.supabaseKey) {
                        this.isConfigured = true;
                        this.supabaseUrl = config.supabaseUrl;
                        this.supabaseKey = config.supabaseKey;
                    }
                }
            }

            saveConfig(url, key) {
                const config = {
                    supabaseUrl: url,
                    supabaseKey: key
                };
                localStorage.setItem('bddailytopup_config', JSON.stringify(config));
                this.supabaseUrl = url;
                this.supabaseKey = key;
                this.isConfigured = true;
                this.initializeSupabase();
                this.hideConfigModal();
                showNotification('Configuration saved successfully!', 'success');
            }

            showConfigModal() {
                document.getElementById('configModal').style.display = 'flex';
            }

            hideConfigModal() {
                document.getElementById('configModal').style.display = 'none';
            }

            initializeSupabase() {
                if (this.supabaseUrl && this.supabaseKey) {
                    this.supabase = window.supabase.createClient(this.supabaseUrl, this.supabaseKey);
                    console.log('Supabase initialized successfully');
                }
            }

            getSupabase() {
                if (!this.supabase) {
                    throw new Error('Supabase not configured. Please set up your configuration first.');
                }
                return this.supabase;
            }
        }

        // User Authentication System
        class AuthSystem {
            constructor(configManager) {
                this.configManager = configManager;
                this.currentUser = null;
                this.isAdmin = false;
            }

            async init() {
                if (!this.configManager.isConfigured) {
                    return;
                }

                const supabase = this.configManager.getSupabase();
                
                // Check if user is logged in
                const { data: { session } } = await supabase.auth.getSession();
                if (session) {
                    await this.loadUserProfile(session.user.id);
                }
                this.updateUI();
                
                // Listen for auth changes
                supabase.auth.onAuthStateChange(async (event, session) => {
                    if (session) {
                        await this.loadUserProfile(session.user.id);
                    } else {
                        this.currentUser = null;
                        this.isAdmin = false;
                    }
                    this.updateUI();
                });
            }

            async loadUserProfile(userId) {
                const supabase = this.configManager.getSupabase();
                const { data: profile, error } = await supabase
                    .from('profiles')
                    .select('*')
                    .eq('id', userId)
                    .single();

                if (profile && !error) {
                    this.currentUser = {
                        id: profile.id,
                        email: profile.email,
                        name: profile.full_name,
                        phone: profile.phone,
                        isAdmin: profile.is_admin
                    };
                    this.isAdmin = profile.is_admin;
                }
            }

            async register(userData) {
                try {
                    const supabase = this.configManager.getSupabase();
                    const { data: authData, error: authError } = await supabase.auth.signUp({
                        email: userData.email,
                        password: userData.password,
                    });

                    if (authError) throw authError;

                    // Create user profile
                    const { error: profileError } = await supabase
                        .from('profiles')
                        .insert([
                            {
                                id: authData.user.id,
                                email: userData.email,
                                full_name: userData.name,
                                phone: userData.phone,
                                is_admin: false
                            }
                        ]);

                    if (profileError) throw profileError;

                    await this.loadUserProfile(authData.user.id);
                    this.updateUI();
                    return { success: true };

                } catch (error) {
                    return { success: false, error: error.message };
                }
            }

            async login(email, password) {
                try {
                    const supabase = this.configManager.getSupabase();
                    const { data, error } = await supabase.auth.signInWithPassword({
                        email: email,
                        password: password,
                    });

                    if (error) throw error;

                    await this.loadUserProfile(data.user.id);
                    this.updateUI();
                    return { success: true };

                } catch (error) {
                    return { success: false, error: error.message };
                }
            }

            async logout() {
                const supabase = this.configManager.getSupabase();
                await supabase.auth.signOut();
                this.currentUser = null;
                this.isAdmin = false;
                this.updateUI();
            }

            updateUI() {
                const loginBtn = document.getElementById('loginBtn');
                const registerBtn = document.getElementById('registerBtn');
                const logoutBtn = document.getElementById('logoutBtn');
                const userInfo = document.querySelector('.user-info');
                const userName = document.getElementById('userName');
                const userAvatar = document.getElementById('userAvatar');
                const navAdmin = document.querySelector('.nav-admin');
                const mainContent = document.getElementById('mainContent');
                const dashboard = document.getElementById('dashboard');
                const adminPanel = document.getElementById('adminPanel');

                if (this.currentUser) {
                    loginBtn.style.display = 'none';
                    registerBtn.style.display = 'none';
                    logoutBtn.style.display = 'block';
                    userInfo.style.display = 'flex';
                    userName.textContent = this.currentUser.name;
                    userAvatar.textContent = this.currentUser.name.charAt(0).toUpperCase();

                    if (this.isAdmin) {
                        navAdmin.style.display = 'block';
                    }

                    // Show dashboard instead of main content
                    mainContent.style.display = 'none';
                    dashboard.style.display = 'block';
                    
                    if (this.isAdmin) {
                        adminPanel.style.display = 'block';
                        this.loadAdminData();
                    } else {
                        adminPanel.style.display = 'none';
                        this.loadUserData();
                    }
                } else {
                    loginBtn.style.display = 'block';
                    registerBtn.style.display = 'block';
                    logoutBtn.style.display = 'none';
                    userInfo.style.display = 'none';
                    navAdmin.style.display = 'none';
                    
                    mainContent.style.display = 'block';
                    dashboard.style.display = 'none';
                    adminPanel.style.display = 'none';
                }
            }

            async loadUserData() {
                if (!this.configManager.isConfigured) return;
                
                const ordersLoading = document.getElementById('ordersLoading');
                ordersLoading.style.display = 'block';

                try {
                    const supabase = this.configManager.getSupabase();
                    const { data: orders, error } = await supabase
                        .from('topup_requests')
                        .select('*')
                        .eq('user_id', this.currentUser.id)
                        .order('created_at', { ascending: false });

                    if (error) throw error;

                    document.getElementById('totalOrders').textContent = orders?.length || 0;
                    document.getElementById('completedOrders').textContent = orders?.filter(o => o.status === 'completed').length || 0;
                    document.getElementById('pendingOrders').textContent = orders?.filter(o => o.status === 'pending').length || 0;

                    const ordersList = document.getElementById('ordersList');
                    if (orders && orders.length > 0) {
                        ordersList.innerHTML = orders.map(order => `
                            <div class="order-item">
                                <div>
                                    <strong>${order.package_name}</strong>
                                    <div>$${order.amount} â€¢ ${new Date(order.created_at).toLocaleDateString()}</div>
                                </div>
                                <span class="order-status status-${order.status}">${order.status}</span>
                            </div>
                        `).join('');
                    } else {
                        ordersList.innerHTML = '<p>No orders found.</p>';
                    }
                } catch (error) {
                    console.error('Error loading user data:', error);
                    showNotification('Error loading orders', 'error');
                } finally {
                    ordersLoading.style.display = 'none';
                }
            }

            async loadAdminData() {
                if (!this.configManager.isConfigured) return;
                
                const adminLoading = document.getElementById('adminLoading');
                adminLoading.style.display = 'block';

                try {
                    const supabase = this.configManager.getSupabase();
                    const { data: requests, error } = await supabase
                        .from('topup_requests')
                        .select(`
                            *,
                            profiles:user_id (email, full_name)
                        `)
                        .order('created_at', { ascending: false });

                    if (error) throw error;

                    const table = document.getElementById('requestsTable');
                    if (requests && requests.length > 0) {
                        table.innerHTML = requests.map(req => `
                            <tr>
                                <td>#${req.id}</td>
                                <td>${req.profiles?.email || 'N/A'}</td>
                                <td>${req.package_name}</td>
                                <td>$${req.amount}</td>
                                <td>${req.payment_method}</td>
                                <td>${req.player_id}</td>
                                <td><span class="order-status status-${req.status}">${req.status}</span></td>
                                <td>
                                    <button class="action-btn btn-approve" data-id="${req.id}">Approve</button>
                                    <button class="action-btn btn-reject" data-id="${req.id}">Reject</button>
                                </td>
                            </tr>
                        `).join('');

                        // Add event listeners to action buttons
                        document.querySelectorAll('.btn-approve').forEach(btn => {
                            btn.addEventListener('click', async (e) => {
                                await this.updateOrderStatus(e.target.dataset.id, 'completed');
                            });
                        });

                        document.querySelectorAll('.btn-reject').forEach(btn => {
                            btn.addEventListener('click', async (e) => {
                                await this.updateOrderStatus(e.target.dataset.id, 'failed');
                            });
                        });
                    } else {
                        table.innerHTML = '<tr><td colspan="8" style="text-align: center;">No requests found</td></tr>';
                    }
                } catch (error) {
                    console.error('Error loading admin data:', error);
                    showNotification('Error loading requests', 'error');
                } finally {
                    adminLoading.style.display = 'none';
                }
            }

            async updateOrderStatus(orderId, status) {
                try {
                    const supabase = this.configManager.getSupabase();
                    const { error } = await supabase
                        .from('topup_requests')
                        .update({ 
                            status: status,
                            updated_at: new Date().toISOString()
                        })
                        .eq('id', orderId);

                    if (error) throw error;

                    showNotification(`Order ${status} successfully`, 'success');
                    this.loadAdminData(); // Refresh the table
                } catch (error) {
                    console.error('Error updating order:', error);
                    showNotification('Error updating order', 'error');
                }
            }
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            const configManager = new ConfigManager();
            const authSystem = new AuthSystem(configManager);

            // Initialize configuration
            configManager.init();

            // Save configuration
            document.getElementById('saveConfig').addEventListener('click', () => {
                const url = document.getElementById('supabaseUrl').value;
                const key = document.getElementById('supabaseKey').value;
                
                if (!url || !key) {
                    showNotification('Please enter both URL and Key', 'error');
                    return;
                }

                configManager.saveConfig(url, key);
                authSystem.init(); // Initialize auth system after config is saved
            });

            // Load packages
            loadPackages();

            // Mobile menu functionality
            const mobileMenuBtn = document.getElementById('mobileMenuBtn');
            const mobileNav = document.getElementById('mobileNav');
            const closeMobileNav = document.getElementById('closeMobileNav');

            mobileMenuBtn.addEventListener('click', () => {
                mobileNav.classList.add('active');
            });

            closeMobileNav.addEventListener('click', () => {
                mobileNav.classList.remove('active');
            });

            // Auth modal functionality
            const authModal = document.getElementById('authModal');
            const authTabs = document.querySelectorAll('.auth-tab');
            const authForms = document.querySelectorAll('.auth-form');
            const loginBtn = document.getElementById('loginBtn');
            const registerBtn = document.getElementById('registerBtn');
            const logoutBtn = document.getElementById('logoutBtn');
            const loginForm = document.getElementById('loginForm');
            const registerForm = document.getElementById('registerForm');

            // Auth tab switching
            authTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabName = tab.getAttribute('data-tab');
                    
                    authTabs.forEach(t => t.classList.remove('active'));
                    authForms.forEach(f => f.classList.remove('active'));
                    
                    tab.classList.add('active');
                    document.getElementById(tabName + 'Form').classList.add('active');
                });
            });

            // Open auth modal
            loginBtn.addEventListener('click', () => {
                if (!configManager.isConfigured) {
                    showNotification('Please configure Supabase first', 'error');
                    configManager.showConfigModal();
                    return;
                }
                authModal.style.display = 'flex';
                document.querySelector('.auth-tab[data-tab="login"]').click();
                mobileNav.classList.remove('active');
            });

            registerBtn.addEventListener('click', () => {
                if (!configManager.isConfigured) {
                    showNotification('Please configure Supabase first', 'error');
                    configManager.showConfigModal();
                    return;
                }
                authModal.style.display = 'flex';
                document.querySelector('.auth-tab[data-tab="register"]').click();
                mobileNav.classList.remove('active');
            });

            // Close modal
            document.querySelectorAll('.close-modal').forEach(btn => {
                btn.addEventListener('click', () => {
                    authModal.style.display = 'none';
                });
            });

            // Form submissions
            loginForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                
                const result = await authSystem.login(email, password);
                if (result.success) {
                    authModal.style.display = 'none';
                    showNotification('Login successful!', 'success');
                } else {
                    showNotification(result.error, 'error');
                }
            });

            registerForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const userData = {
                    name: document.getElementById('registerName').value,
                    email: document.getElementById('registerEmail').value,
                    password: document.getElementById('registerPassword').value,
                    phone: document.getElementById('registerPhone').value
                };
                
                const result = await authSystem.register(userData);
                if (result.success) {
                    authModal.style.display = 'none';
                    showNotification('Registration successful!', 'success');
                } else {
                    showNotification(result.error, 'error');
                }
            });

            // Logout
            logoutBtn.addEventListener('click', () => {
                authSystem.logout();
                showNotification('Logged out successfully', 'success');
            });

            // Navigation
            document.querySelectorAll('.nav-home').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    document.getElementById('mainContent').style.display = 'block';
                    document.getElementById('dashboard').style.display = 'none';
                    document.getElementById('adminPanel').style.display = 'none';
                    mobileNav.classList.remove('active');
                });
            });

            document.querySelectorAll('.nav-dashboard').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    if (authSystem.currentUser) {
                        document.getElementById('mainContent').style.display = 'none';
                        document.getElementById('dashboard').style.display = 'block';
                        document.getElementById('adminPanel').style.display = authSystem.isAdmin ? 'block' : 'none';
                    }
                    mobileNav.classList.remove('active');
                });
            });

            document.querySelectorAll('.nav-admin').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    if (authSystem.isAdmin) {
                        document.getElementById('mainContent').style.display = 'none';
                        document.getElementById('dashboard').style.display = 'none';
                        document.getElementById('adminPanel').style.display = 'block';
                    }
                    mobileNav.classList.remove('active');
                });
            });

            // Refresh admin data
            document.getElementById('refreshRequests').addEventListener('click', () => {
                if (authSystem.isAdmin) {
                    authSystem.loadAdminData();
                }
            });

            // Notification system
            function showNotification(message, type) {
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    padding: 15px 20px;
                    border-radius: 4px;
                    color: white;
                    z-index: 10000;
                    font-weight: 500;
                    transition: all 0.3s ease;
                    background-color: ${type === 'success' ? '#2ecc71' : '#e74c3c'};
                `;
                notification.textContent = message;
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.remove();
                }, 3000);
            }

            // Load packages function
            async function loadPackages() {
                const packagesGrid = document.querySelector('.packages-grid');
                const packages = [
                    { id: 1, name: 'Starter Pack', diamonds: 100, price: 0.99 },
                    { id: 2, name: 'Basic Pack', diamonds: 310, price: 2.99 },
                    { id: 3, name: 'Popular Pack', diamonds: 520, price: 4.99 },
                    { id: 4, name: 'Elite Pack', diamonds: 1060, price: 9.99 },
                    { id: 5, name: 'Royal Pack', diamonds: 2180, price: 19.99 },
                    { id: 6, name: 'Legendary Pack', diamonds: 5600, price: 49.99 }
                ];

                packagesGrid.innerHTML = packages.map(pkg => `
                    <div class="package-card" data-diamonds="${pkg.diamonds}" data-price="${pkg.price}">
                        <div class="package-header">
                            <h3>${pkg.name}</h3>
                        </div>
                        <div class="package-body">
                            <div class="diamond-count">
                                <i class="fas fa-gem"></i> ${pkg.diamonds}
                            </div>
                            <div class="price">$${pkg.price}</div>
                            <button class="buy-btn" data-package="${pkg.diamonds} Diamonds" data-price="${pkg.price}">Buy Now</button>
                        </div>
                    </div>
                `).join('');

                // Add event listeners to buy buttons
                document.querySelectorAll('.buy-btn').forEach(button => {
                    button.addEventListener('click', () => {
                        if (!configManager.isConfigured) {
                            showNotification('Please configure Supabase first', 'error');
                            configManager.showConfigModal();
                            return;
                        }

                        if (!authSystem.currentUser) {
                            showNotification('Please login to make a purchase', 'error');
                            authModal.style.display = 'flex';
                            return;
                        }

                        const package = button.getAttribute('data-package');
                        const price = button.getAttribute('data-price');
                        
                        document.getElementById('package').value = package;
                        document.getElementById('price').value = `$${price}`;
                        
                        document.getElementById('purchaseModal').style.display = 'flex';
                    });
                });
            }

            // Purchase modal functionality
            const purchaseModal = document.getElementById('purchaseModal');
            const purchaseForm = document.getElementById('purchaseForm');
            const paymentOptions = document.querySelectorAll('.payment-option');
            const paymentMethodInput = document.getElementById('paymentMethod');

            // Payment option selection
            paymentOptions.forEach(option => {
                option.addEventListener('click', () => {
                    paymentOptions.forEach(opt => opt.classList.remove('selected'));
                    option.classList.add('selected');
                    paymentMethodInput.value = option.getAttribute('data-method');
                });
            });

            // Close purchase modal
            purchaseModal.querySelector('.close-modal').addEventListener('click', () => {
                purchaseModal.style.display = 'none';
                paymentOptions.forEach(opt => opt.classList.remove('selected'));
                paymentMethodInput.value = '';
                purchaseForm.reset();
            });

            // Purchase form submission
            purchaseForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                if (!paymentMethodInput.value) {
                    showNotification('Please select a payment method', 'error');
                    return;
                }

                try {
                    const supabase = configManager.getSupabase();
                    const orderData = {
                        user_id: authSystem.currentUser.id,
                        package_name: document.getElementById('package').value,
                        amount: document.getElementById('price').value.replace('$', ''),
                        payment_method: paymentMethodInput.value,
                        player_id: document.getElementById('playerIdModal').value,
                        status: 'pending'
                    };

                    const { data, error } = await supabase
                        .from('topup_requests')
                        .insert([orderData])
                        .select();

                    if (error) throw error;

                    // Show success message
                    purchaseForm.style.display = 'none';
                    document.getElementById('successMessage').style.display = 'block';

                    setTimeout(() => {
                        purchaseModal.style.display = 'none';
                        purchaseForm.style.display = 'block';
                        document.getElementById('successMessage').style.display = 'none';
                        purchaseForm.reset();
                        paymentOptions.forEach(opt => opt.classList.remove('selected'));
                        paymentMethodInput.value = '';

                        // Refresh user data
                        authSystem.loadUserData();
                    }, 3000);

                    showNotification('Order placed successfully!', 'success');

                } catch (error) {
                    console.error('Error creating order:', error);
                    showNotification('Error placing order', 'error');
                }
            });

            // CTA button scrolls to packages
            document.querySelector('.cta-button').addEventListener('click', () => {
                document.querySelector('.packages').scrollIntoView({ behavior: 'smooth' });
            });
        });
    </script>
</body>
</html>
